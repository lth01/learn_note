---
Date: 2024-01-02
reference: https://git-scm.com/book/ko/v2/Git-%EB%8F%84%EA%B5%AC-%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88
Subject: Git 서브모듈 사용법 & 원리
---
# 서브모듈이 무엇인가
내가 학부 연구원 시절에 ns3기반 시뮬레이터인 ndnSIM을 사용한 적이 있다. ndnSIM 디렉토리 안에는 NFD, ndn-cxx 등등 정체를 알 수 없는 디렉토리들이 산재해있었고 각각의 디렉토리마다 별도의 git 저장소가 존재했다. 내가 수정한 소스코드를 기본 디렉토리(ndnSIM)에서 커밋했을 때 하위 디렉토리의 변경이력이  커밋되지 않아 NFD, ndn-cxx 디렉토리안의 .git파일을 제거하여 코드를 github에 게시하여 문제를 해결했었다.

관리의 편의성상 지금도 동일한 해결방법으로 접근할 것 같지만, 원인을 알고 문제를 해결한것과 뒷걸음치다 문제를 해결한 것은 산과 땅차이가 있기에 이번 기회에 정리해보려한다.

## 서브모듈
지금 내가 사용하는 옵시디언 프로젝트처럼 개인적인 폴더, 파일들은 private로 관리해야하나, 오르미 백엔드 교육과정에서 정리하는 공부내용들은 public으로 오픈되어야한다.

위의 문제를 어떻게 해결해볼 수 있을까? 내가 private한 저장소를 갖고있을때, 저장소 내부 디렉토리가 public한 저장소의 포인터(커밋 해시)를 가리키며 저장하는 상황이라면 해결할 수 있을 듯하다. 

실제 대부분의 프로젝트는 다른 라이브러리, 패키지의 종속성을 갖는다. 내가 임포트하여 사용하는 패키지가 버그가 발생하였고, 프로젝트 마감을 위해 패키지 소스코드를 임의로 수정했으나.. 패키지의 다음 버전이 나오며 해당 버그가 수정되었고, 프로젝트는 다시 패키지를 가져와야하는 상황이 있다 가정해보자.
단순히 패키지가 파일로만 관리된다면 다음과 같은 과정을 거쳐 원본 패키지(업데이트가 완료된)파일로 교체할 것이다.

1. 새로운 버전의 패키지파일을 어딘가에 저장한다.
2. 기존 프로젝트 소스코드에 있는 패키지파일을 모두 제거한다.
3. 새로운 버전의 패키지파일을 다시 프로젝트 파일로 옮겨놓는다.

솔직히 그다지 어렵지 않다. 종속성이 있는 패키지가 1개라면 말이다.

실 업무에서 프론트엔드 업무를 할때, 다른 부서의 모듈 9개 정도가 종속성이 있었다. 이걸 위의 과정을 다 거친다고 생각해보자. 과연 10분안에 모든 패키지를 업데이트하고, 빌드를 시작할 수 있을까?
- **절대 아니다..**

이런 문제를 해결하기위해 나온게 서브 모듈이다.

즉 상위의 레포지토리에서 하위의 레포지토리들을 관리하기 위해서 만들어진 git의 기능이라 볼 수 있다.

이번 정리에서는 어떻게 하면 쉽게 서브 모듈을 사용할 수 있는지를 중점적으로 볼것이다.

## 어떻게 쓰는가
서브모듈은 하나의 레포지토리를 모듈로 가져온다.
즉 부모의 레포지토리가 서브 레포지토리의 내부 소스코드 변화는 추적하지 않는다는 뜻이다.
- 이걸 모르면 내가 학부 연구생 때 겪은 문제를 동일하게 겪을것이다.

그렇다면, 서브 모듈들의 변경점은 어떻게... 반영하지?

git에는 submodule들을 관리하기 위한 명령어가 많은데 이중 foreach를 통해 해결 가능하다!

``` zsh
git submodule foreach 'git commit -am "20240102"'

```

위의 코드는 .gitmodules에 등록된 submodule 디렉토리를 돌며 ' '부분에 있는 명령어를 수행한다.

그러면, 개발자가 작업중 수정한 서브모듈의 소스코드가 있을경우 위의 커맨드로 커밋을 해준다.

그렇게되면, 서브 모듈들은 커밋되어있는 상태일 것이다!

나는 이제 루트 레포지토리에서 아래의 코드를 통해 commit과 push를 해주면된다!
```shell
git commit -am '커밋 메세지'

git push --recurse-submodules=on-demand
```

git commit이야 익숙하겠지만, git push --recurse-submodules=on-demand가... 뭐지? 싶을 수 있다.

간단하다!

1. 먼저 서브 모듈들의 커밋건을 push해줘!
2. 그다음 현재 루트 레포지토리의 커밋을 push할게!

위의 과정을 축약한 명령어이다.

### 그러면 내가 수정된걸 받을때는?
이것 역시 간단하다
```shell
 git submodule update --remote
```

위의 명령어 한줄이면 각 submodule의 최신 커밋버전으로 git이 알아서 다운로드를 해준다!

## 마치며
간단하지만, 이해하기 전에는 어려운 서브모듈... 사실 기본적인 걔념과 사용법만 정리했지 정확히 서브 모듈의 모든 기능을 안하고 말하기는 어려울 것같다.
레퍼런스 링크를 참고하여 나중에 다시 보강하여 설명을 적어보겠다.