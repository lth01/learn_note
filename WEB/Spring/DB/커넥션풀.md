---
Date: 2024-03-19
reference: 스프링 DB 1편 - 인프런
---
## DB 커넥션
DB 커넥션을 획득할 땐 다음과 같은 복잡한 과정을 거친다.

1. 애플리케이션 로직은 DB드라이버를 통해 커넥션을 조회한다.
2. DB 드라이버는 DB와 TCP/IP 커넥션을 연결한다. (3 way handshake같은 동작발생)
3. DB 드라이버는 TCP/IP 커넥션 연결이 생기면, ID, PW와 부가정보를 DB에 전달한다.
4. DB는 서버가 전달한 ID, PW를 통해 내부 인증을 완료하고 내부에 DB세션을 생성한다.
5. DB는 커넥션 생성이 완료되었다는 응답을 보낸다.
6. DB드라이버는 커넥션 객체를 생성해서 클라이언트에 반환한다.

JDBC 기본 예제에서 PreparedStatement를 사용하기 위해선 그때마다 커넥션을 맺었어야했다.

`DBDriver.getConnection()`을 호출했을 때 매번 커넥션을 새로 맺고 연결된 커넥션을 반환하는 것은 DB, 서버 모두에게 큰 부하를 줄 것이다.

따라서 이런 문제를 해결하는 아이디어가 커넥션 풀이다.

## 커넥션 풀
미리 DB 커넥션을 일정 수만큼(개발자가 설정 가능) 맺어두고, 어플리케이션 로직에서 커넥션을 달라 호출했을 때 커넥션 풀에 있는 커넥션 중 한개를 반환한다. 어플리케이션 로직이 종료되면 커넥션이 풀에 반환된다.

**정리**
1. 커넥션 풀 숫자는 성능테스트를 통해 정해야한다.
2. 커넥션 풀은 최대 DB 커넥션의 수를 제한할 수 있다. 따라서, DB에 커넥션이 무한정 생기는 문제를 방지할 수 있다.
3. **실무에서는 항상 기본으로 사용한다.**
4. 보통 히카리 CP를 사용한다.

## DataSource 이해
DataSource는 커넥션을 제공하는 인터페이스이다.

DataSource를 사용하므로써 구현체를 변경할 때 발생하는 사이드 이펙트를 줄일 수 있다.

### DriverManager와 차이

DriverManager는 매번 커넥션을 얻기 위해URL, ID, PW등의 정보를 알고있어야하나

DataSource는 구현체를 처음 생성하는 단계를 거치면 더이상 URL, ID, PW를 사용하지 않는다.

이는 코드의 결합도를 낮추는 효과가 있다.
